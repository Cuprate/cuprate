
//! Functions to verify a monero `RangeSig`

#![allow(non_snake_case)]

use monero::util::ringct::{RangeSig, CtKey};
use curve25519_dalek::edwards::{CompressedEdwardsY, EdwardsPoint};
use curve25519_dalek::scalar::Scalar;
use curve25519_dalek::traits::Identity;
use thiserror::Error;

use crate::H2;

#[derive(Error, Debug)]
pub enum BorromeanError {
    #[error("Sum of Ci does not equal C (out_pk)")]
    SumCiDoesNotEqualC,
    #[error("Computed ee does not equal stored ee")]
    ComputedeeDoesNotEqualStored,
    #[error("One (or more) of the stored Ci keys is an invalid point")]
    StoredCiKeyIsAnInvalidPoint

}

fn verify_borromean(P1: Vec<EdwardsPoint>, P2: Vec<EdwardsPoint>, bbee: Scalar, bbs0: Vec<Scalar>, bbs1: Vec<Scalar>) -> Result<(), BorromeanError> {
    let mut LV: Vec<u8> = Vec::with_capacity(2048);
    for i in 0..64 {
        let LL = EdwardsPoint::vartime_double_scalar_mul_basepoint(&bbee, &P1[i], &bbs0[i]);
        let chash = monero::Hash::hash_to_scalar(LL.compress().as_bytes()).scalar;
        let LV_temp = EdwardsPoint::vartime_double_scalar_mul_basepoint(&chash, &P2[i], &bbs1[i]);
        LV.extend(LV_temp.compress().as_bytes());
    }
    let eecomp = monero::Hash::hash_to_scalar(&LV);

    if !(eecomp.scalar == bbee) {
        Err(BorromeanError::ComputedeeDoesNotEqualStored)
    }
    else {
        Ok(())
    }
}


pub fn verify_rangesig(C: &CtKey, rs: &RangeSig) -> Result<(), BorromeanError> {
    let mut P1 = Vec::with_capacity(64);
    let mut P2 = Vec::with_capacity(64);
    let mut bbs0 = Vec::with_capacity(64);
    let mut bbs1 = Vec::with_capacity(64);

    let bbee = Scalar::from_bytes_mod_order(rs.asig.ee.key);

    let mut C_temp = EdwardsPoint::identity();

    for i in 0..64 {
        bbs0.push(Scalar::from_bytes_mod_order(rs.asig.s0.keys[i].key));
        bbs1.push(Scalar::from_bytes_mod_order(rs.asig.s1.keys[i].key));
        P1.push(CompressedEdwardsY::from_slice(&rs.Ci.keys[i].key).decompress().ok_or(BorromeanError::StoredCiKeyIsAnInvalidPoint)?);
        P2.push(P1[i] - H2[i]);
        C_temp += P1[i];
    }
    if C_temp.compress().as_bytes() != &C.mask.key {
        Err(BorromeanError::SumCiDoesNotEqualC)
    }
    else {
        verify_borromean(P1, P2, bbee, bbs0, bbs1)
    }
}

#[test]
fn test() {
    let hex = hex::decode("02000202000bbfa9fa02ebf623899213ffc215a2e802829f01d591029505c648a409b906432707c206f9d0f28558d3bf0f5e09ddd15f598ff109f42557254ffe272c197302000bb6c466ffb4cb028be510fceb01fae503f69403bb02d16f7ebb51885737e41b405cda207e873ec07633cd24a0b32187e5d61e62d7bae26d913b18e9560200020cc0682f62480c153cc08a18bc6aa46291fdae720606a5f44e8beaa266b0eedb000293dcb03c7ca5fccc6188ee7cbadfbd6242ec5c4f3b228e9388da48e9f5d26c9421016c5ec38d0ba4fb1b9a7e00ed1f703bea1482873d09545437cfbca3f26cab03db02c0e7b4e007fa3318604a3aa23843ccf51250f99676a0c98514d935b6ac1ce97ea0835483f1b93e0be08ff96f610fc7f0c7c5bb4f77c1845019d81bd5f607ac68c568442f1c359cc4736f40fe43dfd1577f75b5d301c6931af25c49117ccf53d4da0d562e0385082b43f734ef571ec75bd0e1f3ea1f398245f0699abf5112ab364939bdca0a5db74fd621fa67ebb8c4500af4fc9f7ac86f5ffa01571e3ef2d276afbbb6f0099bbde164dc34da61640bf06d08ccfba64831ee2a2513e39acaf283e36c4eb001b45beccd3b98404be0dd5545258ac4638c563cf1f37a8dd3d129b34df16c86efcb7e63d3d55a5bac3ad01687348fadb63408730756676cb7cc1750eb4b14d15a72de8f1ea3c75a1e6c93e3fa05e033f4ed616ee5d467446c7283200b0100eb0776b8870d464310e1727af2ce6b58acbfd096f02721396e4335278b89ac9f710fc4044cd973f0ee5b3d698a3c09b59b5a72d9a198444c1767c43b052a987da3057f381ad16061497e7e91eb74b40b133e6a725298d75af412c800b490c446c7019cbafcefff4d01f125555360cf95934a8082be60292f5d26f55ee0c33ca65f0aea07a5987b78b3ff2c355d5e3554ec8580a44a8c43610808c7f36f40b204a905bb304568fd5781d65a880a0fa5d72efef3018ef1e7d6e0f61500f753e52af80aa720e720c2974f8f94396077ae38b7fdee425ca13056e017e3f3d61d1badc90ac4a02db6a723c41b49d82548686bdc688f3fd7d4d24eb7d6b0407bf585498a00f66095f64b21b9718ae63d3864af58bd2d89fa96900ce6db5bf9cf87b4bda40b90a24c78749f4776a3efe8ae8272d0f5dc37ab72db13f4bf678a18cfbb49c5096b76f405b811460eedee44f0854612948a1024e995429f4eff7cd7704f8f99025208e53611e7efcc77452ca5a327277caafa7afc33582b5bb62877415c96e60660c7779ee1f5a5c6cd5f3c868a6a8ed0918da99af87067cc3692a29a00beec0b3eb7915801584f9583dfd5edd9e95b40131698e9c74c3fffc5bb9c7dcd732505c595a6733b33a53e3640f169610e94ea635f61c9b95a8450db149fb0d09463021f4898b809bf3ec812c2a95bbb30db32020d423c8c52fbd129105c7e4e09d707a11cb94f64ec42328183a953fbc7ec0e476d4f8fbdfaf32c06565fd765485b02402f3a2ba738942be9b419190acc42ea038b4a0d32a724cd78651a7366c7510862652d3f5349b4543d48835c2b798535fe09feb12f2118b931556760218c55082a4196398e37e4cf8d9e761a9e96b81925abdbff9bfbf3c8bd31f1964b285d0dd93dd476d3b2b9a6bdaf1d0d5f3ff9790e1a1cab432b0fd5dd86321be72860070cbc7570514a4f871e93b85348b6a681a21f071e817d0ca91c589a51e45d530e570c721cae41840b1e127bdcdef7b5956b139d5ecd52eb53b202164fc0d155062a656c62c03a4c5e0a039eecab7bf0198682c7ce61ba7a709cb61e79de63cc0cee2e302570b3b12303999eb114d8284641bc48a509d946f7c2f9311b5f48410dc1729abddbddf39b79b8d5151e4b09fc8c4e97efa65b8d6b58eafbe5e4a0d30eecc8d28740a0bceebcbb4402bb5cba627f256474d24fb2e5cc89d68e641a8009db3c7f63cd60cb9c374a18de3b84f5ef7b1340a962b061ab1e677923d8ca350c3d7cfffc8ee8d0b2bb0cf047f503091e52185411228a48ec29d29fbaa5dfc0001ab88d6ab72be2c8bb7a85ed4e595302703ae5ce10ba2b3394faad5682fad201665e0f70f422a8d90e693f4da4e22756275fe91b44a5178c13488bbb5881ac02d1c2d438abb77c17a36da980363bd0ac57ee05a7773bb5c1253f89da51b69b079195c7a7a11adc778297359794319b15e55301525d38edeb5f92f292d21e63059e005bd44d1e1afa2507de7a6f5bb5a12182654054f9d5a50b8285ae8d84230046198b557b67da289b811407a1731a809048f2922b96f6220602354fa5575f04d4aa9330a7b0024bcb6c3fe07e087571e208dd6713d9b442179f8a9f3d317d0af764a2cc586bc21c1966a99bc441f2a704d594392232654817e31927b5d0a904d9ff2c394e3350f61750079a3c007695fb9f9d0551b4acc159b2cfbdf3353205ec8fa3d0de35e1c958f5876d04ce8f9d2eee117fe94375b1eb0044d9fd706e0af9e4df1b180118dda5e72f63528d578d9c725d5caeebf0e8107c920dc0e29d005350414f78447ddd92a3f465573de0ed35c9a7c64e5a39b246a9e59c6c2f1f090c9cb359bff12acab9a70b811dac535f0bcc34ac3a92f9458e93f4103917b80aa4dfbca14a5abbb1fc9a313608723d4fdd3a9a537c8d9d77173e24c44f3f890a12715fbf5adc8deb4034761e4ac3bb93aed5944f0880e92a4ca075b5c33a8707ae4fde3bbb25eab28efdc4e26a6e410fabb7acedbb74f9f6fb9e8b9b7be41c01d9ebfaf74b994468bc141c01e048af1ec767a51fd7e49cbcedd1e5278f11230e36225f7ed311064a053d66e0f7ce80ac95c44bb1c207730169400bc24dd07d0b8ee8e735d63f306b779864d595a2ca0bed1edf58cf5dfeb5f318d2073cf23104ae4692e6e70f6149590f99a23398e009ed25a7510d59161203832f20b8534502f2ae43ec85cff1e13a892cb9a0a90814e1fe1cdb4614c8efcd41cdcf4c61a5087a8508ac80c48fc88db74686b7c5230b3c4c625de0dd4ad5f85465c8be98e20d17445991b06f7263565c90aa0ca645199694256efc444674a1ced0bdbb237904b9e286d8d4c4e741e7ccecfbc9d928e3de5afe367ff4f6e4488a2fd50c2c5307772a5ff18ba7fbf6ec887342a542f423784c4d4624183a4c8e2b95c39643b10cfb696d0b84a4eed4a8a1111a50288b15b258a2bc3e79db64d2a5427bbe9d3e05b3ebe2bd696fa06c085c84427aafbc83a9d3c3f60e27f16f025fad2a0aa89600904856bb41e6152c4dfb292ef0dc2deb5e7e2e9c6f22a10b90432ac49ddb110d81707f5137189a15965e2b32c7befb5da44ebefb3adf3d376f51f3f16eca25034919bedf44f93e3fadaaa64e4be129bd3ec9befe3a6daa8ea510a0d4d1378f09d2501e757906ae1f736eb2a653135c643eb18fcc6e9659c9f5a488e278d0b0060be8ced73dc87b69dfd883134226e1e22808734f16b1641b3d68825c0e7a530676ced60a2ee6b978c999556543fef7e821f6258c98b4bcfcf259aed67f1b6e0dcd5c1b3df5ca6de1ebabc06e0d21372dc3db135dce07a97f6c4eb4bbb990e108b98d4728587472a1085f9debe166021c17afd77217244efdb6ee7ce2930db601aff148a128799317bc74da4fb8a8f3ab4c262ec2829ad362bc4767dbb962130180d49f125045c5346c5941ca92414c1f09a7e2fd04c9713bfa005947428ea50cf3006add188863325749d5128547ef989bf06d25aaec03e5df19df7272536407c6cedc6a224c8a5ae398138180b41b7a3f53bb592520c5b16f0cdb2517c24208b833acec04984345f08795d0da52bd80eb2c3429fc91fb5c71fe0667083be50aae7eec398df107983e27d3eb9114ef74d42f987f16aa34950cf805b1986ea3066944fabf5ce328e178dca36d29f3b70ed7d65137a05e51bf379b05504b77d10b20050ac014f6f9ea435fe0ea27accee04f3f86b5ff5fc7b5aa64e6cbf98f76088ba92a0426e9272da7461e2da85a6582948557370c188ab523059e4777f5990a39137331490d42c30555da304f7e31727f3e7083e1dcd80b9f6c203a88e36e0748c5643a38dd2e03b022e94b4a955cc563755e3817fad6299e9f1b1d9fb63401d203d1f8b0a57adc26c5748181d8b6c86a08e1807f621b5d86614b2f85ddf401462f0e2e6f8ab8f7269e8186d1223c992f0e82c4562aa2a271b862bdee9a420c87835ab72396b3eade1ae6650b0285d5340679ebb66ddc9fdfcc827751889009f9647bfd1b3c1dc301a3debac7471372013f932cdfacc980c447e9d92807600917436c602502b1214f42593cb65fb78ca14c69311f644ccbd762a029eb901807d4d315b61ece5c990e63a09e7a9feaaacca33bde061ad779bc7cc613784aaa0405cb220574a5391e7ed307aeaddada8bc2784cdcce96817dbf3ef62c5ddb0800c1e187996c8266fc0dd40047e3bb7a66e054fdda5d09355dc860f8bf4cb2cb032787c0347903d3eff2781efc31cad853d9f4a3a3d69f4391e7fb34a3096c360d59baab9b120578168255e2998b247afe4ef8bc6411c5a6d86866d055497c150fac52b904fe566c4c26807520244b9368e3e0496a483f09ed175690ca35306b0188826e5d35b60c8ce3e31f0a299346315a1e9807d1ab3d948339f1b00878f5024ef0825c4c417107627fd105e2e8ad535d731a67c61d705c5e22620980c2c90d5925d24303282664784307abfbf3f2563c9568496c14c119d90a079cda39f9096b38c98f7efc0c072fae366693a843338f9ec9093409392cf0aa9555289b1901f3b2e3b5db68b805fad38c39adddc3843e811fb407ce61eff503d89deee6570b0ebd8a67423398de7be39318249c30a5b5d9f3224daba45dacff6beb22cb000427dd96f167f5734394915d47008e1d9ec34860375b769f4f984828c537ac560f4ddf16bba5b58bbdc44a3a217c52f5e4db5a02e09164aa08964c1026d2e47f0c0fe4c44e97436d4e3d6a0483e47204832e8dac84657111a5ad471dbc79de3b07fcefaadab37e69380aedc994fb73b5addc309f7fab87a37b88dbdcf93b05030520656bb69d93b9eda7775652e9978918ae42bafeacb748a9145ca862ccc42808eedce2179aff6bca107d30b47249596e8f88488f3cafc7f7cea637fcd5d5200f64ec0799d7a588ea616fa7bdd41d6d035fcc575f9dd8b8aee359f1627a53460bb61b6ff91f94ef22521d5773b730cd9b9e901b5ef0fd7a1a7da46381fff05c0faea20c8be9e35693f7d943620a219af1d201ec3bf46f01d324a6a8f9ebb6a805582712661eff2ee6bb48abd72b66b4b3b042e04d23d2f7488a7f739772ee3702798ec8be1aa18038749d9e11c3ee171895e4c36a174bb87afa7fa5e75e105b0caf47e7c65714e6c45ef8014b616fd346f216c7fd850e1dc397d1b156c8e22b0c471d87118ff48bd9354fe543ce4e8f6af8b6d63aeb3a7cd884170ffef5b30a001b2f141ece98c1b593302746a8a0f7115ac39c582ac81275612c98ec1909050d270ccb4910637af1c6835a48a05259a4aad6f5a8ffc206431afca1da8f28ed0079407061a17e14baa0d34299e1482457bd14d5ff6119d14495e0d0d4fb67000d4b279061acccc8c30d3168571f8d4e449220a8246c653a1ca68102e4e8ac8b08c7516fd85aefe0ce5fbad2d8cd9a26493ddadaa4b5574eae2795c013ba88560f7cc9272134c19f55266b5b113cbaf41e1323c33738d6894d616ed556e822fb03222bb8e8612d367861bf0933bcec62b434f7f5a31da3bdfe7aa483bd901bbb07f9ace5e8bebf96d6e7b34486fccb07227dc89ba1e414a96dc5a5b5958cf48c0f63a22ddbc5300a3369635aa36b46dd40591f32c2a2e23b52bcd12e29e8fae805428cef11c3292f7d59974b41fda9d4f2337c15cbc8c48008964031ecc248be0d54071a84c167e5e43ce5a591df4160fc1fc21b4628ff8f740d16db23f7aa6105c2687654e77364c4a502c31f520a95997e7be5422992b2766b952fc19991ef09b983fbf0e6b08d14606d032e02a78bd4198dcf19ad3cb76aee87a1c210c40709af30eee7174977e2df19bcf871248d740fec2a7ee0f5578c7296126eafd15e0930900bbb398e3acc3021d5410941a779df8f60f03f9f037a4301b36c1a20c305ba1dbc5668229d429c593a4c63ac9fd0248a26d839c69c5c591766dd5799e509158b9add9ab66acec01ec380aeb553722618a6d014614cd01f91b117cfcd540e5a110306cdc662644960997e1f73e51096ebbb69aa472bb8231fc742692fc404693c14f5e9de703c75261108bf81be79e8ade2bf49ccb692d0ffd9c5e618f7061b4af078076d40da4a810602ecfafc3e2ad049d00eeab5c99148b6250717960bc3cd3b9e443d67ce5269d7a710e59dd04d2c055f4511dab19589eb1b27cacf0fdc55e1d155694ae020278701b34efb82b4f70fe2fba6da096b9f9ac2eaa85404ae7c3b57ceef6a9d6b8b981f47ba226ad1d4dfa9d4399b29f3984c75a883d503cce6f91396205a3eaf367db1a3ca27fa38fa70cc63a94f24fae5e9c2f5345431ad1c816adae2c2f33ccd0c61a01ba5e8aae189faafc89c5e8140a1c63cfd01864e267f476a5796929f749f83daa7dfbc279d9b5f094c6168199932a28c1612f28ff23a345d0ee63c897e647d0fed2abc241938131443d7d08232bfc94cd61516911eddcf2fdd57c3ae875f20bec43ba0da99369deed4d08583e98daabc5b721ff61794a2e08601fea94bb3abc50f84edcc13ceaa43e74e806db548b1be83e0f4a7eb2207eea7055b517a20d57c464a43ded3a722b60ad89913e54387ca35d4b1872f4da539ff80ac034e2f22a938d2c6bdb998c8e43c01f56f31e2ea8c091249a31a06b1c1fbf18842099047148d0bb079d98499d22bd65a71f1ee88f989a7987847129d9b545ff7f8aed36869658c1435863f8b3bbd20e8ccae59b8eda77d973eca07cee0d8a2779e31d0707eb48597f2c86311ef2eae725b2560c92ba8c795c3fa8d9c555632e39428672682e6d51a758d8d1ea871f7a07549d225e969fa8620e8775c3339cc67dd63bb1c6b760a6854d0b011bd16691208c8cdae4a17ca88b1c83c404cc8822a40be234e2f5a30edf14a900985aa3bcc3a1d80376238415c7ee16fe8ced7c13cb0abe79780a87de2621614d62d850ff20ad149a3d474f197f8b25a5b5fb30e055fc1fe2124d2636d762bf9de914d8eacceacda1c737c76705796a8070fde35a2b1d5fbc6e4d6847abfc639f77fe9000b899e61e8dc4dd143f8f39185c3d33c8a40f74839cbcf6904becf88f2ee64c04ce0244d9f49927c8bb97e56615de834f9c155617889871477d5c3ee0b91649481766a3ceca57457d74a6aec24b733681539d695ef639759898516f11bd5df97ea0f8e6a6e6021880527920c0325ca2a0dace1888b116cc2b53d707a81997fd77ec0258dc462fbca625c5690c57084527ac6a56badead5bcbc9fe386ca83b8d5ece84916fb9623b696cf65b0f56e24370c9d6d64284354c9301c5de8a5edb51d7785122a6d5360ae0a67404f3c8dcd1da70df82f26aeca66abfcc9a821620707433f3f0a2d8fa59090d138293672b381fb0b07f0b6e8caa8ee8c8aaa4a7834d2755c3f5939d2ff35e573b07a5244155c0049598e7edc42d53253ded064491bdde9a44f5837abe934049b71bd35eef4d8edc976c585d10c3ab405f7e0ec002f1cdbbf08e596f13f2f95f872a22625141340897c0eeca075816df5457465b8306794dfeb49744b0da69cd421caa4e1fc73695392f0f3325e6cfe48af1119e7a833228c0e7c2a3423974fdf8d5026571b88c0c2d2db9d482f2cb72eca09499f774212f79c1fd4c64d026390cb2aaaf2ab702d850cb533ae7e3780b6b543285c5c82cd8700cedfcc8087ef1ace9b65e3e0df418b3a89bcc5f53c111b111d496c9479067c2593132a92d4f8ce8d1a0d15c115fbcbb3c1bfb50b7ed7f98d16e678349807f45b102794c4299d68e727ae0268ff22b0fe5e2979079477be838729152282a21caf784c61bb4c4de03597336025ad2bd18bffa12ade03374b0a29db736c0e08b1e81b189a7344f915acfd05e6954eeb094bb1e88249fe9a34c14026ab1a98b4994bc3e8d996333d7afef32d38cf7823905c6576380baa9682f24306d8492cfd3d885fbf1eef59830e9bb73cd68f36c5247fb93126e7d491bcee7a97a9e03b197da120f231b949f109d2e34e3f863c1b05707d9190cf291524dc31d2c760c73fefcf608032814c35f287e05b46b94fcfcf60a045217f452fe277eb5ed8ffaf70a822c385995651272aaf747f0b8aae2a1b893ab3e57a9b4118a25bd3d08cd2a744de316c4f10e08263e443ca4a7f3b4dcf5afa6391e6831ec2702e7611bf099de3bf7726f5812ecf11d64ebada8296cb9c62abf41a052867c705b5f918337149082f3624126c552c32707ec2ca71f2187e1a6d83ee6d99a80938b9a65560ad3055238075ac5343d9b4d1b0700eb7152ea88257913ecd498bcbed629d22cca0fcb9842fd15bacb0ed27bd6e8844bbf4c488ffd237d12eb3a55ccf19c115f66b579e632cc8e03ea266c36c0d04157f4642bda4c1a61fedd9c7cf8ba921297d9dc5a1554917f98ac944ccc53c1fc05b39d936025d6012b580ef7be73ad1f9c9a9b198906a78fe572bbf05e446ebfbeed9b02c7b859b1def214e182804ba10753d3b81157e8fe4fd466df1c9d5ecafc5d692a1310e894c4228aeafcf6692691b54f4136660750927171c8069d09b8f24ec8c7f6f951e2d736a14d7cd42263658e3ea13657a75a6b2f1dbcc87c4f759e73dc8c064d1a92cad52e597b3689fd3604519bdd8a74e89e8fe443d37793f080d0f834096b81f9978b2db47f693390b4675fe066de34025e57e418a856f1c92a9ecc8c588c4c9824be71696932c77d4d32fbf91c85017ce0a07977b04071dd9ed59300a1d8d19aa67fdb8ae68dfd81527e171520209235184fd70b3d2bfce84a137027756e1e14f187861a7313b5aa58df383fdebe297bee5f5a298119cf807ca07e6e660cc1d75648a5419619f9d8135ffc44ca5f90e1a887d88abef4a4d0811f2af6f80c212f7191ff0ba291fe01287b3b21da651bdde28a0f2547b2854bfef2b11ea042a6edc3d6e16239e24a908481cf78c1d05576f24fd350c2450693a70a653837a06f6f8dfdedd30316dcf7efefdc818ee84716f703731d208a7a4d83df7b1ff0a28cdc2688ddaf269432801b486d13b66bf05b1b4b9191bdf89f14f8c00817b4448f2b198641642330004ef0973df0e839fa74879cb3e3c1939aaaffa83bec853bc546ea51e8830dcf00edc24367c71f5be583faf5987622aa454c6ec16149ef6044cfc98cb14a115d2621ae7314371b8b7d5b40a471703b564c5b8f68bffbca90d14cfd41e40900f06634f849bd3a1053c3dae5bc10a6f1d45051fc33c8101604e9b6078df555c3139ea1a96e95674ae77bb6d47a30c82536ef60e745fc655e4bcef18cb1f4061647a5dafc59f34c78e3c8c5b3fbe0e4cd1e5d37231bd863d7865a4f421978349624f7696de9280589ccde57315e4099160cd0ce3bce1c77c4d1e00d9a1570d8fb4a20dc6145393e6c1e95364b27b070eff626c4624e2c50997ed7c10005c70099af18c54dfddcdc33a1e724449d20304c17aeb03fb6db0faffeef0cfa663e77a953c0f6724cfd24485df238b51030639f157531d88dbb2b3c00ae60ce79eedbd575d38f05d866baf134042a466300840e0b5e6d85e0c2b8cb2b0e969a1ddca0b06e51c25fbcebaa1c8bc75c5563f0df9eb221bfb258cdf320f18f27d4b270cecee759c8ef16fed868a64d88ebaad09a9768edcd87d9eae6029d1c40aa7ae4d7d67e5e9f5b9a57694ea6a0030d9ab0dc2337b0d1c958016435b1042d74f2207d9a3e0a910497647a7dea0447fee250414a7e6ed7d0480ef8e4c86a74d5b5eb3313f52ff764175d1399b527bbb4d870bd16c3bc0f53a235af245a6ab230f05338aba6d819d0c2bd502052d5286661a0b5671de1e555552d6f223b93998bdba67cad6062a6d557fa020d35f92a9b017020f307387a4a4a324f982ede38df89137c2a23f27c4533bbcdf7e4c3ee50fb6065b18f91372239ace6efd8ac8554502ee17cbd4b8278b19d7a96eb109d907d705cf666d2047b3f8478a5751781682ec3e80acb382aed459ff5eebc5b512f8570075de17bf68aa8ce5e39b825a76a31dda6b5c8efebdc283b69621f8db101bca0d5f98eefaaa2863260c203b5762c3e3891e4b282cd624e250e03e877bd29f510292b7498e33e3e9e22a12489a13ed8392457764634882f46e74e17db196f8ff0a31f0dfc4d440fe5ab5724a3f99cf7a3a2c84e8dd53e7d1d49c0669fa7fa8c106b33a6f9c86061d9bfc77295a2fc7fa7295355b4fb670f706899d251082908f02cd8402e1aea919abf47077ea3b99185bed6fa09ee29ae909d82d0a790d56d608465919e3f7479fc83839f8c59a2a8bc84d32754fc79a21c2e597adad2ab1ac0530fad241cdf5f99509f0291f2e0dc7a5320b8e9d91654d7e873edc6506538b0245270baed76e0a3988b368fc6e5eff27300597018908489691e9e1dc7b98e80a3b9e0041aefb95065de9b4be632398f346c8865bb56eec0b491523a47d2a2b05139832acac583ce3f4fd6aab968032c4c5b0160f46e44bcd887ce33d09c2b3072fee6fba315823ce426546baffe62509cfda344d55107bdd87f9d7deff571903cacd5f1027848c9a413ab4fc481c2ddfe0df57d6e29c45af736806a68a8c8e0eba8c06aa3b508ceb68a7bfa668c2ebc1a15e46f470e481e39e8b73d81d61d4094c2e22d67d9da7ff28ffafa9f77c4a7a8fff16fbcf07b9f613a432363815d503dabae7f20fb1b7087120907b82c31e91f216eb11685b3b4b234a4782b3a7990c56ff8616ddf6493ecb6ea16d11ddcd0ab56fba2df20ea2d008db2c9e13e26b05d95f46d074faff2b44756e04df17c3ac87d2f6671a1c2bc6c9da25a0cc11e00a3d8228cb51fd19c89a8dc6d08d68230b22460153d6fac91c0bdc046770068209972cc2714ed49c8d6294bc0e8e967890c306ebb7149ccce36874a94c84cbdd022337d219d2b81428f33b7c5db1f242c03541ed7dfdffe4c12a54d010b34176078d79b8280984cd3c7eb105c0317cb5d170357cb7f27eb9c8916ff7c5b944d108a90b237104aa2889b2f96e00fb72cd8cd45534fa21e9c5457ba46bd0c66c460732c16808a18418b7f010c3cc2569ea6fea9abde77666cebbb53b583caa30250f142893cec5f6aaabc4d4e5db9f94d6bcd7091cecbedd9539e1487b95396ae60e77b8b404ffb750ff6e20d122b230a03361acb1eef4e2b56d35a274ee4c1fe5069a3eaa8618417449899d63aa47ae0cc19b0267ce15a95023fe2ec5cfa1df32035ce209eb8b6a3a7d02219b4c426e256eb0bf866e03cd83678be6583c6e0d61042b2b5816b2ffd55939cf80a8769c5e216ad1987749969faafae0c132d0440e05c7e166cba08346e87c4e15f86a8762282810ba53d969c41c1dd2e21c06508609b67eab8a3eaa0c6218952cc09865efdb171b168f35c93c9ee378abcb724fd50205e6f85c76c67038179c47f18d3b651999354b5dd268a97a41b5def60ba8910d41dda2936a69432379c430b48bddf99c583f1e15c8049aeb679982c9654f1d08a829ac4fc820b1a8151bd5dc7b65e174207dd535f0665182515492c0a04cca0077561ae30725705663cb8d55db66539b25e35e9dd2ff436d2f972da70056c301fdfab672e16ae7ca5901fddc11c0c9927caae59e64dc3fda4010bceedbedb903295e699ddd7860eabf844f34f2d96196bdf1e24a3e8de7c421b5cd892649ee00ee7c43d0354aa5f8f94d0e3556d278604bdd113752a5f48178ccb06a8a39c606d35b434cc52b0f7e1acd1b14f6add17df49a472fa416e9e11070896fd75e860b0e99cbeab9107ce7ebefbcaacbfae5d81bcf3ff11b0dff2fbcb7c5a95ac4b0088b7789b784d000b6d458a07116e817c46f7597c90eef73125c1dadfa0ba85b07cc94fe838962134c6f7c0e833f597bb4561fc40a90fa3da89e75c82990fd2702f805fee8921896b7a4a7f6d68915c9d6db24c6e29a516961f7975bed58878901a44e34baa274d20be08bc0be789e3ba21fd326426201a725c39753becfe63308b59449811e7aad8e6e6640833fc4d3b34a07db3167f9a835da67013f336e04087c22a72f2dea45801ce2f704d53ad8db3fb3a80daf05e56dfa9b1f39fb94de0b993eaea1a8dae5b5d7c7e61b9e530ebadd1824f85469635a007792092e40160a2ae5ef4d85a14e68f62bf7e1cbb86dc068d615ba5c411b013c706a6d7a63c00882306292ae2b5922c038fb5da04a970aa6bef7182c313025b0c23a00f20de40148d35225e718101c31bdc108f11ad6b3fdb562a53922e6310b1c4887b0e82a0a1cafa924502117e9e5babaea46c2bb0abe6dc1b0558b334d4084df372f447d0093877441dc39c34bfc8222ad39afb7573223b0d436cb1a0453d36d4998688e08aca816e23e80718630d8203dd95ebd47be256e9e55fdcd684c930a59564de102d3fb314bf4e41b65fdda54507d8590636516a3800911a599ca91c44e506f2a068f5c073947c3379e73f03c12a9c0962d78662b7c43b4644bbb50b59a18773b0d030dfc8f655255bf4e1b6ca6f5196349c860cb1c21d5c87db4635cb0e9596206dab7062f4cbfcd3b116f5ee01a9aed4db4d20b863ecc9c7b8e9a317a412ba5097cfbfb7e0d2d4a7f0d0bae8abb09f56fe22dd2b6b5e599f8d7c2196f3e2b690716c9a31abb84f1d0525b20920d3bf24205dc812f25f1f3be5bc34b2aaaa6ea076d9e441540622c055c7b73399793ace013b0df751847967a5cd4fe6f7c43ca0764dfff4d07a66022c01e95cdda77bd50a2b8fc8eb4e3cce34cdeb46a393c0c0e888e0036947192afab6d2485c9ae0c4b0c6534115e15a2e2bad8d187a2c15a05528ff415774b51ba15a62efcc075527ad365270e8530cf246b5fd2cad351750fa505f554f04c4f8700bb7c078e0c0bf6e1de47b5cffc158e50afa35f76788202fc367389c64fcbb9ab852d55aced6c2685c5e99c7067ea9dc1f40dcc94c89d09c53c44d7c49c21a5d8283cf980b7d9282fdcfb8a77cdf45d88e2d4f1c5c42c09a041a8e293f62719933c5faac456a9b5eebb6d05baf0bec8ff8c859a70417a0fa0767f6a0b69b2e757ccfea9c6e3796d45e8b43314ff0aca9d949e4c3835d004c1048b3ad6c9256dba2f8225aa68d1f9235ca5a5c7a81bbfde24f1423028a700463d462cf86580507ab292cbb5f48fb86e2ee39beac5e9263fe979bbcb5eb5081766c851dea786ac2f9f2e70f25d3cb290d5eced69a0f581796034c38e8a93066b72964b253cb51dd5bd1a338ca6eddda16e9e8babaf3877891dd13440b69501674c9508fa5c07d9b41890e360db5295b2bd06240917342681fdce049f338200cecbdc411243646b0b6b1c8bd7c7118e709dd00d11621ff8a8b0ff9841da9d06b8e9e7ec745db35a46a6972d3ca19a7337b48213105a7567d374d1479af8ed0158c8cd5bc295a99c6627a6d60923d6db32f18220641ff3a8bc2d083a8f9ea90ac2ef029b62cd141f54dfa5fea628c3050aad134dd040ff69a90c1a72f2a13804c368e1a3a609b5014bf39f6b1b6735ee3b406d51e27f1c558a3a606eca53eb01fd9888d489100002fc4f06ef805518128ca950ae5af22d221efb2bbfc56dbe05e4617afc14d0c45ac668c052305637dddc7ed21c25345c47d0dd94488a24b102bfded7746d9cf86f7ae14ed341f93a28d877e04826337e7d3e4af4c38520290666feee4fbba66286f4152556dbb99cb47f3aecac4fc57e42b53b521f7b386109a42ee8f6acc8222ec998ebd5fdbb2de234aaa005d6b9fab6142d396821ec0902446a96fc77f837d26a21cc59fc49c148123539e2ba7214625d66c7ed00bf0a081c000aab975ef9438e438ea32a16320a769fbf65bbe799d5757a2b382de4470bb9c443e9f265d8cf0bea505b14c01ad5d9e12362f802b5195111c3a9e94c9d0d07f94efb25d51fe411ca572f613b0bf200a83363839ed49fb823d326da06e6061c19af72dbbf1e1f33e2701e10f08ec724cb405874894db0ef52209e8b4a5e04e6fd6721a96bdcbd2e2a4e937c31d27b776bf5806b103eecb0db6fb067f3b30811f1ef042b7978f87643fb6b801e55cd1a91e16f8c200d0ffa2b4b8d097258075a69bd29787733af05ad28c32d3e841e8ace603c6beed9d7db09b887e4277e0f2f5f007a40ca3390609079c037bcc3baa31dd9c97f151cf5fe6a27e141df9400d59584db8635cb694cc9e7390a143c4edf8dc4aeabe18a093b860d45df5e250ea8e0af135ae60f611e251ea1f6a72ed7a3183f6ca599260643af76d212728109b5d441558b48fd733ec3630a6652244960554a9492c51e89cdeac850d01b0f0f46e761b8bd5ac0d0a1a95bbc0f57aa514e3dbc093822cd64d383c68e82e6b0034ee62607049a538871610a127fc505c5e42b26d74f4fa9dfa5412c9f6a92000e9f0b9e669b28886e6b1369b51f339aedd9ad7dd933bd133f1674f1227e8d7b0ceb4eccf3804c160573baee96f9844e2d01eaec7aa59d4093b9a7b9be8763b402e0f1fcd68a170eb49fe149505ef3938d0ad7ac7c00a5f46bee6be2c7bdf4d10b7263d763d3c22b3b44e20b9526291491384be3e74d6b132464e587325cc7060ce17412350abecf7118b55e2cb9b3e2ed51470c013271c498027192f8de83370e846414396efdc0cf1953b8ef68e2b809f1d56f3b616a3e6be0ed506edc8f54016cac892bfec9bf278ab73db0ed4adaf98fc25c60509b1a530ee50c384a0e900199e750101e58998451e3a6c39facb9f06615917185abb3c999b9dea64561240f82681d4ea07a9fffeb1d0757aeee108b47407d28a38982c114786fbd630ed1078eca8048b82d059bbc3abb9d10fce1e075b9ed0b4ade890b42cd133ab6958700099a5c5df2f9cd552d6d12eecd197b7e48743ea22d4b848263e95372fd6f7208b2abdf1ad4d636a5f5ec7f752973c0ae25fe996bb1bd80aa7a0ab97d5ce65805d8bbe023fb3236df04325cdaf676582b1ab96e77863bbd9d0d72846f35d94506413e4f1b1c705aa5853b9059181e8a44ecf0e9f51cefdad4290c39301c897a06e8c4d17357b0f7f89520d28f8af21fcb143310e2634ca38d7558669624f54911c9a749e98a782679fc4d0f622a955681153000ef1197af0c597df5afae6fd2169fa6196965a18200d099d392696f471fcb612d08aeec4f0ee50bdd81c1fa4d10dbf2052d5f96056be4ff5b42245721ad4c62a2e61c789ad384af9411e36991f2664caed81ee764d9e64611ce0c46609ff35807a7d938ae91bdd193a583719c0039114b47ed61b12563bcae52bba1abdd77702a4c9afd67a462180e3f239c4d8da15123bfe22aa2ded42eb0e3e8058e9efcc544a82e8033211751797c925b4937eefe53317683bef6e5fe35abf0fbb09f1349891c38c2c57053ec1061ab7bbca0b8553b56fc925ebb8cad2824afebecbc9165ee38512fb394845771a196de4eae32835c15b271ae6700e389983cf6bf1fdc4ca5d948bb0fc67d83370396c3b3fe348487b3bd189f3bbe694ab9c330527504b11cbd8fab48a41cc067b4398c1bd4e2751772eb8c22de22a255c33dcc93407e3a34a8f9ebde7522a294e8246611417dc405fa2b808892615728adfd96c77903f3a99692b82c1a9171cf288fb78dbc63cd041a795cd830ef205ac9ef12ceb197c64ccd0258123f0cc90ae741cb7b58d3115a2095d128208bd4c9e266bfd63510edbf5769a8559b804038955faea76ee2fc33895388c73d1ed0b3123914382457b3b3f3ae56217c739f467a49447840d6e5aee96ae4ff47b46e14ab9df920af5641be0ecb9c7bff9b0cdf694eba15e237013a5c07b001329bac6eb7915fd7020664ff2505cd59889cc8ffc5af47008ec4604688fd722422378ba6559386f7b37b5d0c92bca1c0bdbfeee9c68f591e46aeb2a3614c968d0a705aecdb82c53aca6bacb34a2cb068c1761cf9e128a774ece56abc800269628437e132d3ec9252592870a50c7b4a17f12fd66e8eef7b7fa72b34d2dd1fe4e3b2042798db62647db4191adb030093d800464954368e6fb9019edca6743c5c48a824b11cca9871f88122a07cd7aaab4fc0228135ebb0dcbd93a684c5dab7d68c55bbcb5ed5a79bb537eeadb5261b865da730eafc1f2ad8c04d027b40ee92ffe23dc2ac531f549ba089842a4f8efd27cd7cf992b5e5e59e15fe50665e1fdbba318faf4f216e0fb442ebe33e99e26dfe793594433a43fe4d54f6a7e7c0dff74cc484ecba55f4d85684345be8e6067e44929d5419cf55ee1468a5b14d50b0361c2456c155a8967e82a45e9a3c2f1ccfbd8ebbf205aeaadcb5ce63aac956f4d7e4a396ee3c429fc3a83b89da8f9a2b2004f188f061281143b50fae02923990df7d910699130a9833fe4a5a1765ac494024ac20984489043cfd9ea02abf0f83fe0958fed32b30d6e0c3792279de04ca8f8e49bcada54c955675343b51b18a7c78a8ba041966b355fbb3fdb4fdf47afcffa1386b963bbb04ad8636b0cd61faf531674cb83c0bb0a4a96f348ee5e4074bbc0dd6ce8ec4dc0e8a72f1b219575d3f4936aafc56700d7b5e9b213ba70ae0d7a8354515b965c3f515afba86cd46e929d068a2651e40adc73243bec8e1ce7deb486e7efb26833f0845af8f7e6a12cea09aee28eb25ec5ae5b25ad8ea568cf484e8506db9878d8dfc9414a1a4666407c36815393ad07cf197301acc15624a07f943692797cd81197b514cb63d7f4da419e33d8efd4716caa7e59c4f67700ed5b6e254a29f77dac980bd88c9eb2f537ded92fad51bd3e4a2bd4ce0cc358a202a0844bc2848ab150f1c87014f9e4dfde39cc412defc13197df8aa060bf0481bbce8ed464ee218153b5638ed0b5011b7ec9a4c150e37888ec951095217c173a1a13f35635f07d1818bf53add472794c1ec970773d778aa7a9d76d6f7abe0e0dbe34eb5a8336f3cb72a89d2ef7d372e3965446d1d2d33ea0755c885a7c5b27db7024e3b0a936130068f66799de788d2f2e60088a2a7e2525569a3e598888010a76f10112ce3aa9c90244ccbdbea87cfaff7943fcd62f6b8d7ea9ca9c7e424d58bd4c1d9c38c42d6347a63745fb33698c34d9fec6dbae576c96d9bdd7ff0b01ead71f993d57d7b5d1e6588ac1c7610d55ca067fb23709d30324870c24a1c797e86a863a27ca0761a248f9c5008780d0002d7133cae9d9dc978d345684c8a0cac2499c5e075f05678ae4176e4cdb92ba57aa0c473350bda3ccf08800cfb4b459c1ccaeda9e0b3f5df419ec3de71ce76c2048ee37a4ee64fad526c3ffba940786f2b65ba024e1f307d881fc79f540a0f2b5af9912b8225698fff9ea7bb4a5eec42521e0fe1fc2d13253d70101968b1fb774b14e574728e07e2301408c284bb153dc405e7101179267168aa0f45fa8a3960e2287dca279b1e828ae4b8480f8576af74f9469f3a33bd39fcb73cd000ff668d22e4f768e9968c8d0b9bd81e40d1110f7425eb7d7758de2d7f2b1fc6ff59fe462db592b3686fba9fec49e5599c9257c85e3c156a1bade3df5e5ca2c003bcb7760fffe16f8950392f17243f9ba5275e44276922fcb6a284e9ac11556fae43ceff73fc013313a029e3f169587c4cb1b1cf2bc2513ff90c2956f70652a45a663cd2b8244c2ab5cca19772306bd1ad14090f4d67b3743bf82454f0de147239be566e74004c108bceac150d8a525b9efc22bf99026e06d17195486170e59f604b2ae7a180b0819215d666cbb0426d7644e684790e4f83b02ab65ba29919a9e33f7d7aa20e454671c13868145e7fe4d3c13d2a7511578c4af9eaced462eef56e715e326c97332466f627e799280faea68ec2dff0fabf2fae669559f529cacbec1633943a0f30e312206a4b162fedf00231c93c218d8c511553a0ccab91abafb9ef728bd9ae8b0374ef3f3e8527c971ef1620f192452119a8ef07661c3fdd1c1e5ef2a95fde83dbaf5c934fbf4ef850ef52099d6cbfcf762b41b42d571b093a227c049b90ef9af18847f1b2edd0481a44ddbbe13cd29bd57bc29fc52bf020bb48bb02edb0c380186afecdccffd7f0fa7f24d65288c9a74b96a9929c736be5ad6545053f0c56b2dfa2923a00ea70d66779b28be920da139fcc12e24675fef35c70cb00c6db428e86f296cd7588a95b94efb7d3dc03c9ee4891e212c75fb15526c41609dc03ad5788af99357d4473c6ba50212569dfc6e600a623ec67227c6c7d96150333712ed5ceaacfedb79da1881d8df619da6c531d800558a41d046311326ad60e97e9ce7bfff63b77dd5532da730d7f5ad3d72217287057021db59e01424b830f6ea5bec66378a4e22e4b6ddb0506bdbc2ed7a875e80bb85bc4bc346135c91c0f2fe2ec6cb0d2c9cf26acce80e4d50d872b11c24453d11c81318c2a00de68ad052362d19cc2583c81a8b9626cc06e96df6857b3a69967734acc0658a17d5da803a923f659807507c3e7530279bb5ee61c979aef1dc2ff7ca6d05a081c207308007b1dbb0d775ee6661f4ed59f69de2795c9c14261724816fb990088e570ed61048f66db8a7a54344ab3b2c6f39833f0be5051a716215f7349f1fd9ed63cf99d0074efc70ac69f4f88bbc8041eb959d25c5ee94c4a707255356bfe1026caf9d40d61c08aedc3c4d70556d0313632f64d418bffced1042161185f456e059f88f7036dc8d163ad98fe57fd7c594d982b24d7d05c44007d0f9a20271991847aeae008715858f9e21f7023bdc701dd456f9d5a5d5ce5397f310ad9fe1edb4e1846d70d8076e27eede615f705798fd919dfe5764bcb764b7c9c21ff7f469155bc642f0267ad65b6818f5065722d751fa4230c09a6761ce3e6606225ac13b21bd2f1ef0bb1ace5c5795f28a42ba0bd7339d9ddab5ee296cdbd58d4ae8e5248301344e50bc2929c5e66d9082842026160fe1cef1cdbaade3520e725437c59d2b9214371090b699a6f09adb7cdff223a21e0c28b2c3998fb2ce48cceb11a6cb08733f2af063e5ad2d01cc4b4bd732830e703dd4713e4d8802a6c3aaf8ff380111d8aaab10b34de2c7920ce93cd15efefe423be16eb2d66e4c96b38ad1eb79c523a09e99202cf6e9c63c860e469be32ba1fdc74d507fc399b34837dacebeb395682634059096db33f5afc4a80b9b987dfb1b98113b3b8be6f5878594ece520669f2f49f120516ae31cc5a999f7ccf8263eab9fd55eddcad382fb8b4103ef4f730d59232dd04261b5ade367d017b6dbb015f33cac0a439627946f797e2b43dbd2554b1cb700daf36ec1153a7574d9af768e9a0eda84361e5ae263c530e260bfb295184eab60a85ea785068a1833129156180215a2dea8c8be0e0143080262ebb8aa44ea4c50fb5a398394ebed794b8b793b96087274f500ba9d4d2fd402396c819e878c89e0ebd1b650c83077e38892c30d0c00b4354c91e95adcb37b8d2135aa96a39670c030d22ac2a218d72177bc55a0b691dce01732395b24624b6f2e804a31969c5d304a3c267e0e4d797af0c28e77d5df4e08006abfd46a4a05b33dfc60b52cdaea10f557c2bee82db9a1196839d33550160e9eb2466c99b6a30807acfb711fd292f09ef90fde56c14dcf1b0134c812a97a14ed6162a4812f41b8e3accc150aada1b074440ffb9b829aa8bb758f533a8073ea6ac4859d657f95b7836ee6b564123d0072177a41d6c72b099fe10b5bca01eeba2aebabee08cbe3f65e7975a2b0fa51a0c51c6fd1a570f7dc87d6fc5ecd6789ba6c655ee01ac9c090845865c3bf49486082716e2bf67d651610e014da8e9fff865f52909954f854a4e70fab9ecd34bb7097570ddffad1b65b6fd5a8e6c4162b46fe2f3442838638bc2150e6c6e80e62102d782e29fb1bbf5357af39edc44ac3de90cfef7619154f78626861c09a09af9026640d6c3fac32af16d32d0de351c047f9946469e7d9adf7fdf9b70e9ca35fa027c96fdf6e3ca0f397f8d3b4b6f276af905df916ee4c2ac8d63d8ff03b6d0010617e0caf6205572a6c8c9d224f3f8dfa7aacc2a3754f1be2e0f6c561913cf0906").unwrap();
    let tx = monero::consensus::deserialize::<monero::Transaction>(&hex[..]).unwrap();

    let out_pk = tx.rct_signatures.sig.unwrap().out_pk[0];
    let rs = &tx.rct_signatures.p.unwrap().range_sigs[0];

    let now = std::time::Instant::now();
    for _ in 0..100 {
        verify_rangesig(&out_pk, rs).unwrap();
    }
    println!("{}", now.elapsed().as_millis() /100);

}